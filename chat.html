<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>ì±„íŒ… + ì‹¤ì‹œê°„ ìœ„ì¹˜</title>
  <link href="https://cdn.jsdelivr.net/gh/sunn-us/SUIT/fonts/static/woff2/SUIT.css" rel="stylesheet"/>

  <style>
    :root{
      --bg:#FFF8F2; --text:#59463E; --muted:#806A5A;
      --primary:#F6A96D; --primary-600:#e98c45;
      --brand:#FFE8C2; --brand-200:#FADFCB;
      --card:#FFFFFF; --card-br:#FFE1CB;
      --shadow-soft: 0 4px 10px rgba(0,0,0,0.06);
      --radius:20px;
      --header-h:72px; --footer-h:90px;
      --resizer-w:10px;
      --desktop-chat-w:420px;           /* ì´ˆê¸° ì±„íŒ… í­ */
      --desktop-chat-w-min:320px;       /* ìµœì†Œ */
      --desktop-chat-w-max:640px;       /* ìµœëŒ€ */
      --sheet-snap-min:20vh;            /* ëª¨ë°”ì¼ ë°”í…€ì‹œíŠ¸ ìŠ¤ëƒ… 1 */
      --sheet-snap-mid:70vh;            /* ìŠ¤ëƒ… 2 */
      --sheet-snap-max:95vh;            /* ìŠ¤ëƒ… 3 */
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --input-h: 64px;                  /* ì±„íŒ… ì…ë ¥ë°” ë†’ì´ */
    }
    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0; font-family:'SUIT',sans-serif;
      background:var(--bg); color:var(--text);
      overflow:hidden; display:flex; flex-direction:column;
    }
    a{ color:inherit; text-decoration:none }

    /* ê³µí†µ ë©”ì¸ ë†’ì´ */
    .main{
      height: calc(100dvh - var(--header-h) - var(--footer-h));
      margin-top: var(--header-h);
      position:relative;
    }

    /* ============ ë°ìŠ¤í¬í†± ë ˆì´ì•„ì›ƒ (ì¢Œ ì±„íŒ… / ìš° ì§€ë„) ============ */
    .desktop-split{
      height:100%; max-width:1400px; margin:0 auto;
      display:none; /* ëª¨ë°”ì¼ ê¸°ë³¸ ë¹„í™œì„± */
      grid-template-columns: var(--desktop-chat-w) var(--resizer-w) 1fr;
    }
    .desktop-split .panel{
      border:2px solid var(--card-br); background:var(--card);
      display:flex; flex-direction:column;
    }
    .desktop-split .panel header{
      padding:10px 12px; border-bottom:1px solid var(--brand-200);
      background:#FFF4E9; font-weight:800;
    }
    .desktop-split .panel .body{
      flex:1 1 auto; display:flex; flex-direction:column;
      overflow:hidden; padding:0;
    }

    .resizer{
      width:var(--resizer-w); cursor:col-resize; background:linear-gradient(#FFD9AF,#FFE8C2);
    }

    /* ì±„íŒ…(ë°ìŠ¤í¬í†±) */
    #chatBoxDesk{
      flex:1 1 auto; overflow:auto;
      padding: 12px 12px calc(var(--input-h) + 12px);
      display:flex; flex-direction:column; gap:10px;
    }
    .msg{ max-width:78%; padding:12px 14px; border-radius:18px; font-size:16px; line-height:1.5; word-break:break-word; }
    .me{ align-self:flex-end; background:#FFE2D1; }
    .other{ align-self:flex-start; background:#FFD9AF; }

    #chatPanelDesk .chat-input{
      position: sticky; bottom: 0; left:0; right:0;
      height: var(--input-h);
      display:flex; gap:8px; align-items:center;
      padding:10px 12px;
      background:var(--card);
      border-top:1px dashed var(--brand-200);
      box-shadow:0 -6px 12px rgba(0,0,0,0.06);
      z-index:1;
    }
    #chatPanelDesk .chat-input input{ flex:1; height:42px; padding:0 12px; font-size:16px; border:1px solid #ccc; border-radius:12px; outline:none; }
    #chatPanelDesk .chat-input button{ height:42px; padding:0 16px; font-size:16px; background:#FFB88A; color:#fff; border:none; border-radius:12px; cursor:pointer; white-space:nowrap; }

    /* ì§€ë„ ìº”ë²„ìŠ¤ (ë°ìŠ¤í¬í†±) */
    #mapCanvasDesktop{ height:100%; width:100%; position:relative; }
    #mapCanvasDesktop .map-bg{
      position:absolute; inset:0;
      background:
        linear-gradient(0deg, rgba(255,255,255,.25), rgba(255,255,255,.25)),
        url('https://tile.openstreetmap.org/5/28/12.png');
      background-size:cover;
      transition: transform .12s ease-out;
    }
    .zoom-controls{
      position:absolute; right:12px; top:12px; display:flex; flex-direction:column; gap:6px; z-index:2;
    }
    .zoom-controls button{
      width:38px; height:38px; border:none; border-radius:10px; background:#fff; box-shadow:var(--shadow-soft); cursor:pointer; font-weight:900;
    }

    /* ============ ëª¨ë°”ì¼ ë ˆì´ì•„ì›ƒ (ì§€ë„ + ë°”í…€ì‹œíŠ¸) ============ */
    .mobile-map{
      position:absolute; inset:0; display:block;
      z-index:0; /* ì§€ë„ëŠ” ì•„ë˜ë¡œ */
    }
    .mobile-map .map-bg{
      position:absolute; inset:0;
      background:
        linear-gradient(0deg, rgba(255,255,255,.25), rgba(255,255,255,.25)),
        url('https://tile.openstreetmap.org/5/28/12.png');
      background-size:cover;
      transition: transform .12s ease-out;
    }

    /* ë°”í…€ì‹œíŠ¸ */
    .sheet{
      position:absolute; left:0; right:0;
      bottom:0; height:var(--sheet-snap-mid);
      max-height: calc(100dvh - 8px); /* ì—¬ìœ  ì¦ê°€ */
      background:#fff; border-radius:16px 16px 0 0;
      box-shadow:0 -8px 24px rgba(0,0,0,.12);
      transform: translateY(0);
      display:flex; flex-direction:column;
      transition: height .18s ease, transform .18s ease;
      will-change: transform, height;
      z-index:3;
    }
    .sheet .handle{
      height:24px; display:flex; align-items:center; justify-content:center; cursor:grab; user-select:none;
    }
    .sheet .handle::before{
      content:""; width:48px; height:5px; border-radius:999px; background:#d9d9d9;
    }
    .sheet header{
      padding:0 14px 8px; font-weight:800; border-bottom:1px solid #f2e6db;
    }

    /* âœ… ë°”í…€ì‹œíŠ¸: ìŠ¤í¬ë¡¤ ì˜ì—­(ë©”ì‹œì§€)ê³¼ ì…ë ¥ë°” ë¶„ë¦¬ */
    .sheet .content{
      flex:1 1 auto; min-height:0;
      overflow:auto;
      padding:12px;
      display:flex; flex-direction:column; gap:10px;
    }

    /* âœ… ë°”í…€ì‹œíŠ¸ í•˜ë‹¨ ì…ë ¥ë°” (content ë°–) */
    .sheet-footer{
      position: sticky; bottom: 0; left: 0; right: 0;
      height: var(--input-h);
      display:flex; gap:8px; align-items:center;
      padding:10px 12px calc(10px + var(--safe-bottom));
      background:#fff;
      border-top:1px solid #f2e6db;
      box-shadow:0 -6px 12px rgba(0,0,0,0.06);
      z-index:3;
    }
    .sheet-footer input{ flex:1; height:42px; padding:0 12px; font-size:16px; border:1px solid #ccc; border-radius:12px; outline:none; }
    .sheet-footer button{ height:42px; padding:0 16px; font-size:16px; background:#FFB88A; color:#fff; border:none; border-radius:12px; cursor:pointer; white-space:nowrap; }

    /* âœ… ê³µí†µ: ì±„íŒ… ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ */
    .chat-box{
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* (ì„ íƒ) ëª¨ë°”ì¼ì—ì„œ ë¦¬ìŠ¤íŠ¸ ì—¬ë°± ì‚´ì§ ë³´ê°• */
    #chatBoxMob{
      padding-bottom: 10px;
    }

    .chat-page .site-footer{
      margin-top: 0 !important;
    }
    
    /* í‘¸í„°ëŠ” ê°€ì¥ ìœ„ ë ˆì´ì–´ë¡œ */
    #footer-root { position: relative; z-index: 10; }

    /* ë°˜ì‘ ì „í™˜ */
    @media (min-width:1024px){
      .desktop-split{ display:grid; }
      .mobile-map{ display:none; }  /* ë°ìŠ¤í¬í†±ì—ì„  ëª¨ë°”ì¼ ë·° ìˆ¨ê¹€ */
    }
    @media (max-width:600px){
      .msg{ font-size:15px; }
    }
  </style>

  <!-- ê³µí†µ í—¤ë”/í‘¸í„° CSS -->
  <link rel="stylesheet" href="css/header.css">
  <link rel="stylesheet" href="css/footer.css">
</head>
<body class="chat-page">
  <!-- ë“œë¡œì–´ -->
  <div class="drawer-backdrop" id="drawerBackdrop" aria-hidden="true"></div>
  <aside class="drawer" id="drawer" aria-hidden="true" aria-label="ëª¨ë°”ì¼ ë‚´ë¹„ê²Œì´ì…˜">
    <header>
      <b>ë©”ë‰´</b>
      <button id="drawerClose" aria-label="ë©”ë‰´ ë‹«ê¸°">âœ•</button>
    </header>
    <nav>
      <a href="about.html">ì„œë¹„ìŠ¤ ì†Œê°œ</a>
      <a href="guide.html">ì´ìš©ë°©ë²•</a>
      <a href="login.html">ë¡œê·¸ì¸</a>
      <a href="notice.html">ê³µì§€</a>
      <a href="mypage.html">ë‚´ì •ë³´</a>
      <a href="points.html">í¬ì¸íŠ¸</a>
      <a href="help.html">ë„ì›€ ìš”ì²­í•˜ê¸°</a>
      <a href="give.html">ë„ì›€ ì£¼ê¸°</a>
      <a href="#">ë¡œê·¸ì•„ì›ƒ</a>
    </nav>
  </aside>

  <!-- ê³ ì • í—¤ë” -->
  <header>
    <div class="container">
      <div class="header-container">
        <div class="header-left">
          <button class="hamburger" id="hamburger" aria-label="ë©”ë‰´ ì—´ê¸°">â˜°</button>
          <nav class="topnav" id="topnav" aria-label="ìƒë‹¨ ë‚´ë¹„ê²Œì´ì…˜">
            <a href="about.html">ì„œë¹„ìŠ¤ ì†Œê°œ</a>
            <a href="guide.html">ì´ìš©ë°©ë²•</a>
            <a href="notice.html">ê³µì§€</a>
          </nav>
        </div>
        <div class="logo"><a href="index.html">EuM:</a></div>
        <div class="header-right" id="rightArea"><!-- header.jsê°€ ì±„ì›€ --></div>
      </div>
    </div>
  </header>

  <!-- ë©”ì¸ -->
  <main class="main">
    <!-- ë°ìŠ¤í¬í†±: ì¢Œìš° ë¶„í•  (ìš°ì¸¡ ì§€ë„ ë¹„ì¤‘ ë” í¼) -->
    <section class="desktop-split" id="desktopSplit">
      <!-- ì±„íŒ… íŒ¨ë„ -->
      <article class="panel" id="chatPanelDesk" aria-label="ì±„íŒ…ì°½">
        <header>ğŸ’¬ ì§ê¿ ì´ìŒì´ì™€ ëŒ€í™”</header>
        <div class="body">
          <div id="chatBoxDesk">
            <div class="msg other">ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
            <div class="msg me">ì•½êµ­ ê°€ëŠ” ê¸¸ì„ ì•Œë ¤ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?</div>
          </div>
          <div class="chat-input">
            <input type="text" id="msgInputDesk" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." />
            <button id="sendBtnDesk">ì „ì†¡</button>
          </div>
        </div>
      </article>
      <!-- ë¦¬ì‚¬ì´ì € -->
      <div class="resizer" id="resizer" aria-hidden="true" title="í­ ì¡°ì ˆ"></div>
      <!-- ì§€ë„ -->
      <article class="panel" id="mapPanelDesk" aria-label="ì§€ë„">
        <header>ğŸ—ºï¸ ì‹¤ì‹œê°„ ìœ„ì¹˜ ê³µìœ </header>
        <div class="body" style="padding:0;">
          <div id="mapCanvasDesktop">
            <div class="map-bg" id="mapBgDesk"></div>
            <div class="zoom-controls">
              <button id="zoomInDesk">+</button>
              <button id="zoomOutDesk">âˆ’</button>
              <button id="recenterDesk">â—</button>
            </div>
          </div>
        </div>
      </article>
    </section>

    <!-- ëª¨ë°”ì¼: ì „ë©´ ì§€ë„ + ë°”í…€ì‹œíŠ¸(ì±„íŒ…) -->
    <section class="mobile-map" id="mobileMap">
      <div class="map-bg" id="mapBgMobile"></div>
      <div class="zoom-controls">
        <button id="zoomInMob">+</button>
        <button id="zoomOutMob">âˆ’</button>
        <button id="recenterMob">â—</button>
      </div>

      <div class="sheet" id="chatSheet" aria-label="ì±„íŒ… ì‹œíŠ¸" aria-expanded="false">
        <div class="handle" id="sheetHandle" aria-label="ë“œë˜ê·¸í•˜ì—¬ ì‹œíŠ¸ ë†’ì´ ì¡°ì ˆ"></div>
        <header>ğŸ’¬ ì§ê¿ ì´ìŒì´ì™€ ëŒ€í™”</header>

        <!-- ë©”ì‹œì§€ ìŠ¤í¬ë¡¤ ì˜ì—­ -->
        <div class="content" id="chatContentMob">
          <div class="chat-box" id="chatBoxMob">
            <div class="msg other">ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</div>
            <div class="msg me">ì•½êµ­ ê°€ëŠ” ê¸¸ì„ ì•Œë ¤ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?</div>
          </div>
        </div>

        <!-- âœ… ì…ë ¥ì°½: content ë°–, ì‹œíŠ¸ í•˜ë‹¨ ê³ ì • -->
        <div class="sheet-footer">
          <input type="text" id="msgInputMob" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." />
          <button id="sendBtnMob">ì „ì†¡</button>
        </div>
      </div>
    </section>
  </main>

  <!-- í‘¸í„°(í•˜ë‹¨ ë„¤ë¹„ ëŒ€ìš©) -->
  <div id="footer-root"></div>

  <!-- ê³µí†µ ìŠ¤í¬ë¦½íŠ¸ -->
  <script src="js/header.js"></script>
  <script src="js/footer.js"></script>

  <script>
    /* ===== í‘¸í„° ë†’ì´ ë°˜ì˜ ===== */
    function fitFooter(){
      const f = document.querySelector('#footer-root .site-footer');
      if(f){ document.documentElement.style.setProperty('--footer-h', f.offsetHeight + 'px'); }
    }
    function mountFooterAndFit(){
      renderFooter({ mount:'#footer-root', siteName:'EuM:', tagline:'ë”°ëœ»í•œ ì—°ê²°, í•¨ê»˜ ë§Œë“œëŠ” ìš°ë¦¬ ë™ë„¤' });
      requestAnimationFrame(fitFooter);
    }
    mountFooterAndFit();
    window.addEventListener('resize', fitFooter);

    /* ===== ì±„íŒ… ì „ì†¡ (ë°ìŠ¤í¬í†±/ëª¨ë°”ì¼ ê³µí†µ ìœ í‹¸) ===== */
    function bindChat(sendBtnId, inputId, boxId){
      const btn = document.getElementById(sendBtnId);
      const input = document.getElementById(inputId);
      const box = document.getElementById(boxId);
      function send(){
        const txt = input.value.trim();
        if(!txt) return;
        const el = document.createElement('div');
        el.className = 'msg me';
        el.textContent = txt;
        box.appendChild(el);
        input.value = '';
        box.scrollTop = box.scrollHeight; // ìµœì‹  ë©”ì‹œì§€ë¡œ
      }
      btn.addEventListener('click', send);
      input.addEventListener('keydown', e=>{ if(e.key==='Enter') send(); });
    }
    bindChat('sendBtnDesk','msgInputDesk','chatBoxDesk');
    bindChat('sendBtnMob','msgInputMob','chatBoxMob');

    /* ===== ë°ìŠ¤í¬í†±: ë¦¬ì‚¬ì´ì € (ì±„íŒ…í­ ê°€ë³€) ===== */
    (function(){
      const split = document.getElementById('desktopSplit');
      const rz = document.getElementById('resizer');
      if(!split || !rz) return;
      let dragging=false, startX=0, startW=0;

      function px(n){ return `${n}px`; }
      function getLeftWidth(){
        const cols = getComputedStyle(split).gridTemplateColumns.split(' ');
        return parseFloat(cols[0]);
      }
      function setLeftWidth(n){
        const min = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--desktop-chat-w-min')) || 320;
        const max = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--desktop-chat-w-max')) || 640;
        const clamped = Math.max(min, Math.min(max, n));
        split.style.gridTemplateColumns = `${px(clamped)} var(--resizer-w) 1fr`;
        // ì§€ë„ SDKê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì„œ resize íŠ¸ë¦¬ê±°
      }

      rz.addEventListener('mousedown', (e)=>{
        dragging=true; startX=e.clientX; startW=getLeftWidth();
        document.body.style.userSelect='none';
      });
      window.addEventListener('mousemove', (e)=>{
        if(!dragging) return;
        setLeftWidth(startW + (e.clientX - startX));
      });
      window.addEventListener('mouseup', ()=>{
        dragging=false; document.body.style.userSelect='';
      });
    })();

    /* ===== ëª¨ë°”ì¼: ë°”í…€ì‹œíŠ¸ ë“œë˜ê·¸ ìŠ¤ëƒ… (ì‹¤ì¸¡ ê¸°ë°˜) ===== */
    (function(){
      const sheet = document.getElementById('chatSheet');
      const handle = document.getElementById('sheetHandle');
      if(!sheet || !handle) return;

      const vh = () => Math.max(window.innerHeight, document.documentElement.clientHeight);
      const mainEl = document.querySelector('.main');

      function cssVhVar(name, fallbackVh){
        const raw = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        const num = parseFloat(raw);
        return isNaN(num) ? fallbackVh * vh() : (raw.endsWith('vh') ? (num/100)*vh() : num);
      }

      function getSnaps(){
        const mainH = mainEl ? mainEl.clientHeight : vh();
        const maxCap = Math.min(mainH - 8, 0.98 * vh());
        const minPx  = Math.max(80, cssVhVar('--sheet-snap-min', 0.20));
        const midPx  = Math.min(cssVhVar('--sheet-snap-mid', 0.70), maxCap);
        const maxPx  = Math.min(cssVhVar('--sheet-snap-max', 0.95), maxCap);
        return { minPx, midPx, maxPx };
      }

      function setH(px){ sheet.style.height = Math.round(px) + 'px'; }

      function snap(to){
        const {minPx, midPx, maxPx} = getSnaps();
        const target = (to==='min')? minPx : (to==='max')? maxPx : midPx;
        sheet.style.transition = 'height .18s ease, transform .18s ease';
        setH(target);
        sheet.setAttribute('aria-expanded', to==='max' ? 'true':'false');
        // ì§€ë„ SDK ì“°ë©´ ì—¬ê¸°ì„œ resize íŠ¸ë¦¬ê±°
      }

      let startY=0, startH=0, dragging=false;

      function onStart(y){
        dragging=true; startY=y; startH=sheet.getBoundingClientRect().height;
        sheet.style.transition='none';
      }
      function onMove(y){
        if(!dragging) return;
        const dy = startY - y; // ìœ„ë¡œ ì˜¬ë¦¬ë©´ +
        const {minPx, maxPx} = getSnaps();
        const next = Math.max(minPx, Math.min(maxPx, startH + dy));
        setH(next);
      }
      function onEnd(){
        if(!dragging) return;
        dragging=false; sheet.style.transition='';
        const cur = sheet.getBoundingClientRect().height;
        const {minPx, midPx, maxPx} = getSnaps();
        const upThreshold   = (midPx + maxPx) * 0.55;
        const downThreshold = (minPx + midPx) * 0.45;
        if(cur >= upThreshold) snap('max');
        else if(cur <= downThreshold) snap('min');
        else snap('mid');
      }

      // í„°ì¹˜ + ë§ˆìš°ìŠ¤ ë“œë˜ê·¸
      handle.addEventListener('touchstart', e=>onStart(e.touches[0].clientY), {passive:true});
      handle.addEventListener('touchmove',  e=>onMove(e.touches[0].clientY), {passive:true});
      handle.addEventListener('touchend', onEnd);
      handle.addEventListener('mousedown', e=>onStart(e.clientY));
      window.addEventListener('mousemove', e=>onMove(e.clientY));
      window.addEventListener('mouseup', onEnd);

      // ì…ë ¥ì°½ í¬ì»¤ìŠ¤ ì‹œ ìë™ ìµœëŒ€
      const input = document.getElementById('msgInputMob');
      if(input){
        input.addEventListener('focus', ()=> snap('max'));
        input.addEventListener('blur',  ()=> snap('mid'));
      }

      // íšŒì „/ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ìŠ¤ëƒ… ì¬ì ìš©
      window.addEventListener('resize', ()=>{
        const cur = sheet.getBoundingClientRect().height;
        const {minPx, midPx, maxPx} = getSnaps();
        const d = [
          {k:'min', v:Math.abs(cur-minPx)},
          {k:'mid', v:Math.abs(cur-midPx)},
          {k:'max', v:Math.abs(cur-maxPx)}
        ].sort((a,b)=>a.v-b.v)[0].k;
        snap(d);
      });

      // ì´ˆê¸°: ì¤‘ê°„
      snap('mid');
    })();

    /* ===== ì„ì‹œ ì§€ë„ í™•ëŒ€/ì¶•ì†Œ ë°ëª¨ (SDK ë¶™ì´ë©´ ì œê±°) ===== */
    function bindZoom(bgId, inId, outId, reId){
      const bg = document.getElementById(bgId);
      const zin= document.getElementById(inId);
      const zout= document.getElementById(outId);
      const rec= document.getElementById(reId);
      if(!bg || !zin || !zout || !rec) return;
      let scale=1;
      function apply(){ bg.style.transform = `scale(${scale})`; bg.style.transformOrigin='center'; }
      zin.addEventListener('click', ()=>{ scale=Math.min(2.0, scale+0.1); apply(); });
      zout.addEventListener('click', ()=>{ scale=Math.max(1.0, scale-0.1); apply(); });
      rec.addEventListener('click', ()=>{ scale=1.0; apply(); });
    }
    bindZoom('mapBgDesk','zoomInDesk','zoomOutDesk','recenterDesk');
    bindZoom('mapBgMobile','zoomInMob','zoomOutMob','recenterMob');
  </script>
</body>
</html>