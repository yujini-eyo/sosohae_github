<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.adminBoard">

  <sql id="columns">
    articleNO, parentNO, title, content, id, imageFileName, is_notice, writeDate
  </sql>

  <resultMap id="adminArticleMap" type="com.myspring.eum.admin.vo.AdminArticleVO">
    <id     property="articleNO"     column="articleNO"/>
    <result property="parentNO"      column="parentNO"/>
    <result property="title"         column="title"/>
    <result property="content"       column="content"/>
    <result property="id"            column="id"/>
    <result property="imageFileName" column="imageFileName"/>
    <result property="isNotice"      column="is_notice"/>
    <result property="writeDate"     column="writeDate"/>
  </resultMap>

  <!-- 목록 -->
  <select id="adminList" parameterType="map" resultMap="adminArticleMap">
    SELECT <include refid="columns"/>
    FROM board_article
    ORDER BY is_notice DESC, writeDate DESC
    <if test="offset != null and limit != null">
      LIMIT #{offset}, #{limit}
    </if>
  </select>

  <!-- 단건 -->
  <select id="adminselectArticleByNo" parameterType="int" resultMap="adminArticleMap">
    SELECT <include refid="columns"/>
    FROM board_article
    WHERE articleNO = #{value}
  </select>

  <!-- 등록 -->
  <insert id="admininsertNewArticle"
          parameterType="com.myspring.eum.admin.vo.AdminArticleVO"
          useGeneratedKeys="true" keyProperty="articleNO">
    INSERT INTO board_article
      (parentNO, title, content, id, imageFileName, is_notice)
    VALUES
      (COALESCE(#{parentNO}, 0),
       #{title},
       #{content},
       #{id},
       #{imageFileName},
       <choose>
         <when test="isNotice != null">#{isNotice}</when>
         <otherwise>0</otherwise>
       </choose>)
  </insert>

  <!-- 공지 토글 -->
  <update id="adminupdateNoticeFlag" parameterType="map">
    UPDATE board_article SET is_notice = #{isNotice}
    WHERE articleNO = #{articleNO}
  </update>

  <!-- 삭제 -->
  <delete id="admindeleteArticle" parameterType="int">
    DELETE FROM board_article WHERE articleNO = #{value}
  </delete>

  <!-- (선택) 이미지 제거 -->
  <update id="adminclearImage" parameterType="int">
    UPDATE board_article SET imageFileName = NULL
    WHERE articleNO = #{value}
  </update>
</mapper>