<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.adminBoard">

  <!-- AdminArticleVO 매핑: DB는 snake_case, VO는 camelCase -->
  <resultMap id="ArticleMap" type="com.myspring.eum.admin.vo.AdminArticleVO">
    <id     column="articleNO"     property="articleNO"/>
    <result column="parentNO"      property="parentNO"/>
    <result column="title"         property="title"/>
    <result column="content"       property="content"/>
    <result column="id"            property="id"/>
    <result column="imageFileName" property="imageFileName"/>
    <result column="is_notice"     property="isNotice"/>   <!-- 통일 포인트 -->
    <result column="writeDate"     property="writeDate"/>
  </resultMap>

  <!-- 목록: 공지 먼저, 최신순 / limit, offset 옵션 -->
  <select id="selectAllArticles" parameterType="map" resultMap="ArticleMap">
    SELECT
      articleNO, parentNO, title, content, id, imageFileName,
      is_notice, writeDate
    FROM board_article
    ORDER BY is_notice DESC, articleNO DESC
    <choose>
      <when test="limit != null and offset != null">
        LIMIT #{limit} OFFSET #{offset}
      </when>
      <when test="limit != null">
        LIMIT #{limit}
      </when>
    </choose>
  </select>

  <!-- 단건: parameterType=int 이면 #{value} 사용 (단일 파라미터 규칙) -->
  <!-- DAO에서 @Param("articleNO")를 쓰면 WHERE articleNO = #{articleNO}로 바꿔도 됩니다. -->
  <select id="selectArticle" parameterType="int" resultMap="ArticleMap">
    SELECT
      articleNO, parentNO, title, content, id, imageFileName,
      is_notice, writeDate
    FROM board_article
    WHERE articleNO = #{value}
    LIMIT 1
  </select>

  <!-- 등록: is_notice / imageFileName 조건부 포함 -->
  <insert id="insertNewArticle" parameterType="map"
          useGeneratedKeys="true" keyProperty="articleNO">
    INSERT INTO board_article
    <trim prefix="(" suffix=")" suffixOverrides=",">
      parentNO, title, content, id,
      <if test="imageFileName != null and imageFileName != ''">imageFileName,</if>
      <if test="isNotice != null">is_notice,</if>
      writeDate
    </trim>
    <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
      #{parentNO}, #{title}, #{content}, #{id},
      <if test="imageFileName != null and imageFileName != ''">#{imageFileName},</if>
      <if test="isNotice != null">#{isNotice},</if>
      NOW()
    </trim>
  </insert>

  <!-- 삭제: parameterType=int → #{value} -->
  <delete id="deleteArticle" parameterType="int">
    DELETE FROM board_article WHERE articleNO = #{value}
  </delete>

  <!-- 공지 목록 (eum/notice.jsp 등에서 사용) -->
  <select id="selectNoticeList" resultMap="ArticleMap">
    SELECT
      articleNO, parentNO, title, content, id, imageFileName,
      is_notice, writeDate
    FROM board_article
    WHERE is_notice = 1
    ORDER BY articleNO DESC
  </select>

  <!-- 공지 플래그 업데이트 -->
  <update id="updateIsNotice" parameterType="map">
    UPDATE board_article
    SET is_notice = #{isNotice}
    WHERE articleNO = #{articleNO}
  </update>

  <!-- (선택/레거시) 스키마 하드코딩 제거 버전: 필요 시만 사용하고, 가능하면 insertNewArticle만 쓰세요. -->
  <insert id="insertArticle" parameterType="map">
    INSERT INTO board_article (title, content, id, imageFileName, is_notice)
    VALUES (#{title}, #{content}, #{id}, #{imageFileName}, #{isNotice})
  </insert>

</mapper>
