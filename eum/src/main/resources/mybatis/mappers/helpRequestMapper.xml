<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eum.help.dao.HelpRequestDAO">

  <!-- VO 매핑 -->
  <resultMap id="HelpRequestMap" type="com.myspring.eum.help.vo.HelpRequestVO">
  <!-- 
    <id     column="id"            property="id"/>
    <result column="requester_id"  property="requesterId"/>
    <result column="type"          property="type"          javaType="com.eum.help.vo.HelpType"/>
    <result column="region"        property="region"        javaType="com.eum.help.vo.Region"/>
    <result column="day"           property="day"           javaType="java.time.LocalDate"/>
    <result column="time"          property="time"          javaType="java.time.LocalTime"/>
    <result column="urgency"       property="urgency"       javaType="com.eum.help.vo.Urgency"/>
    <result column="title"         property="title"/>
    <result column="points"        property="points"/>
    <result column="scheduled_at"  property="scheduledAt"   javaType="java.time.LocalDateTime"/>
    <result column="status"        property="status"        javaType="com.eum.help.vo.RequestStatus"/>
    <result column="created_at"    property="createdAt"     javaType="java.time.LocalDateTime"/>
    <result column="updated_at"    property="updatedAt"     javaType="java.time.LocalDateTime"/>
    --> 
  </resultMap>

  <!-- 공통 컬럼 목록 -->
  <sql id="Base_Column_List">
    id, requester_id, type, region, day, `time`, urgency, title, points,
    scheduled_at, status, created_at, updated_at
  </sql>

  <!-- 목록 조회 (페이징) -->
  <select id="findAll" resultMap="HelpRequestMap">
    SELECT
      <include refid="Base_Column_List"/>
    FROM help_request
    ORDER BY id DESC
    LIMIT #{limit} OFFSET #{offset}
  </select>

  <!-- 단건 조회 -->
  <select id="findById" resultMap="HelpRequestMap">
    SELECT
      <include refid="Base_Column_List"/>
    FROM help_request
    WHERE id = #{id}
  </select>

  <!-- 등록 (PK 자동 채움) -->
  <!-- 
  <insert id="insert"
          parameterType="com.eum.help.vo.HelpRequestVO"
          useGeneratedKeys="true" keyProperty="id" keyColumn="id">
    INSERT INTO help_request
      (requester_id, type, region, day, `time`, urgency, title, points,
       scheduled_at, status, created_at, updated_at)
    VALUES
      (#{requesterId}, #{type}, #{region}, #{day}, #{time}, #{urgency}, #{title}, #{points},
       #{scheduledAt}, #{status},
       #{createdAt,jdbcType=TIMESTAMP}, #{updatedAt,jdbcType=TIMESTAMP})
  </insert>
 -->
  <!-- 상태 변경 -->
  <update id="updateStatus">
    UPDATE help_request
    SET status = #{status}, updated_at = NOW()
    WHERE id = #{id}
  </update>

</mapper>
