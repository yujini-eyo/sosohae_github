<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.board">
  <!-- (중요) typeAlias 등록: action-mybatis.xml에 아래 추가
       <typeAlias alias="articleVO" type="com.myspring.eum.board.vo.ArticleVO"/> -->

  <resultMap id="ArticleMap" type="articleVO">
    <id     property="articleNO"     column="article_no"/>
    <result property="parentNO"      column="parent_no"/>
    <result property="id"            column="id"/>
    <result property="title"         column="title"/>
    <result property="content"       column="content"/>
    <result property="imageFileName" column="image_file_name"/>
    <result property="writeDate"     column="write_date"/>
  </resultMap>

  <select id="selectAllArticlesList" resultMap="ArticleMap">
    SELECT article_no, parent_no, id, title, content, image_file_name, write_date
    FROM tb_board
    ORDER BY article_no DESC
  </select>

  <select id="selectArticle" parameterType="long" resultMap="ArticleMap">
    SELECT article_no, parent_no, id, title, content, image_file_name, write_date
    FROM tb_board
    WHERE article_no = #{value}
  </select>

  <insert id="insertNewArticle" parameterType="map">
  INSERT INTO tb_board (parent_no, id, title, content, image_file_name, write_date)
  VALUES (#{parentNO}, #{id}, #{title}, #{content}, #{imageFileName}, NOW());
  <selectKey keyProperty="articleNO" resultType="long" order="AFTER">
    SELECT LAST_INSERT_ID()
  </selectKey>
</insert>


  <update id="updateArticle" parameterType="map">
    UPDATE tb_board
       SET title = #{title},
           content = #{content},
           image_file_name =
             CASE WHEN #{imageFileName} IS NOT NULL AND #{imageFileName} != '' THEN #{imageFileName}
                  ELSE image_file_name END
     WHERE article_no = #{articleNO}
  </update>

  <delete id="deleteArticle" parameterType="long">
    DELETE FROM tb_board WHERE article_no = #{value}
  </delete>
</mapper>
