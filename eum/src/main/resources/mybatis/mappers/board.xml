<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.board">

  <!-- action-mybatis.xml에 typeAlias 등록:
       <typeAlias alias="articleVO" type="com.myspring.eum.board.vo.ArticleVO"/> -->

  <!-- DB 컬럼명 ↔ VO 속성 매핑 (DDL 기준) -->
  <resultMap id="ArticleMap" type="articleVO">
    <id     property="articleNO"     column="articleNO"/>
    <result property="parentNO"      column="parentNO"/>
    <result property="id"            column="id"/>
    <result property="title"         column="title"/>
    <result property="content"       column="content"/>
    <result property="imageFileName" column="imageFileName"/>
    <result property="isNotice"      column="is_notice"/>
    <result property="writeDate"     column="writeDate"/>
    <result property="svcType"       column="svc_type"/>
    <result property="region"        column="region"/>
    <result property="reqAt"         column="req_at"/>
    <result property="urgency"       column="urgency"/>
    <result property="points"        column="points"/>
  </resultMap>

  <!-- 목록 -->
  <select id="selectAllArticlesList" resultMap="ArticleMap">
    SELECT articleNO, parentNO, id, title, content, imageFileName,
           is_notice, writeDate, svc_type, region, req_at, urgency, points
    FROM board_article
    ORDER BY is_notice DESC, articleNO DESC
  </select>

  <!-- 단건 -->
  <select id="selectArticle" parameterType="int" resultMap="ArticleMap">
    SELECT articleNO, parentNO, id, title, content, imageFileName,
           is_notice, writeDate, svc_type, region, req_at, urgency, points
    FROM board_article
    WHERE articleNO = #{value}
  </select>

  <!-- 등록: 필수(parentNO,id,title,content) + 선택값은 있을 때만, writeDate는 NOW() -->
 <insert id="insertNewArticle" parameterType="articleVO"
        useGeneratedKeys="true" keyProperty="articleNO" keyColumn="articleNO">
  INSERT INTO board_article
    <trim prefix="(" suffix=")" suffixOverrides=",">
      parentNO, id, title, content,
      <if test="isNotice != null">is_notice,</if>
      <if test="imageFileName != null and imageFileName != ''">imageFileName,</if>
      <if test="svcType != null">svc_type,</if>
      <if test="region  != null">region,</if>
      <if test="reqAt   != null">req_at,</if>
      <if test="urgency != null">urgency,</if>
      <if test="points  != null">points,</if>
      writeDate
    </trim>
    <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
      #{parentNO}, #{id}, #{title}, #{content},
      <if test="isNotice != null">#{isNotice},</if>
      <if test="imageFileName != null and imageFileName != ''">#{imageFileName},</if>
      <if test="svcType != null">#{svcType},</if>
      <if test="region  != null">#{region},</if>
      <if test="reqAt   != null">#{reqAt},</if>
      <if test="urgency != null">#{urgency},</if>
      <if test="points  != null">#{points},</if>
      NOW()
    </trim>
</insert>


  <!-- 수정 -->
  <update id="updateArticle" parameterType="articleVO">
    UPDATE board_article
    <set>
      <if test="title != null">title = #{title},</if>
      <if test="content != null">content = #{content},</if>
      <if test="imageFileName != null">imageFileName = #{imageFileName},</if>
      <if test="isNotice != null">is_notice = #{isNotice},</if>
      <if test="svcType != null">svc_type = #{svcType},</if>
      <if test="region != null">region = #{region},</if>
      <if test="reqAt != null">req_at = #{reqAt},</if>
      <if test="urgency != null">urgency = #{urgency},</if>
      <if test="points != null">points = #{points},</if>
    </set>
    WHERE articleNO = #{articleNO}
  </update>

  <!-- 삭제 -->
  <delete id="deleteArticle" parameterType="int">
    DELETE FROM board_article WHERE articleNO = #{value}
  </delete>

</mapper>
